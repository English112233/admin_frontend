<template>
    <el-form-item :label="label">
        <slot></slot>
        <date-picker
                :id="beginId"
                :name="beginId"
                @update:value="setBeginDate"
                :value="beginValue.substring(0,10)"
                readonly="readonly"
                class="el-input__inner date-picker"
        ></date-picker>
        <span>—</span>
        <date-picker
                :id="endId"
                :name="endId"
                @update:value="setEndDate"
                :value="endValue.substring(0,10)"
                readonly="readonly"
                class="el-input__inner date-picker"
        ></date-picker>
        <slot name="quickSelect">
            <enum-select :options="quickSelect" @change="setQuickDate" style="width: 130px;"
                         placeholder="选择常用日期" :selected-id="quickRange"></enum-select>
        </slot>

    </el-form-item>
</template>
<script>
    import DatePicker from 'bluesdk-vue-datepicker'
    import EnumSelect from './EnumSelect'
    import DateUtil from 'bluesdk-date-util'

    export default {
        name: 'DateRange',
        data () {
            return {
                quickSelect: {
                    'today': '今天',
                    'yesterday': '昨天',
                    'thisMonth': '本月',
                    'lastMonth': '上月'
                },
                quickRange: ''
            }
        },
        props: {
            beginId: {
                type: String,
                default: 'dateBegin'
            },
            endId: {
                type: String,
                default: 'dateEnd'
            },
            beginValue: {
                type: String,
                default: ''
            },
            endValue: {
                type: String,
                default: ''
            },
            label: {
                type: String,
                default: '起止日期'
            },
            commonRange: String,
            minDate: Object,
            maxDate: Object
        },
        components: {DatePicker, EnumSelect},
        mounted () {
            this.setQuickDate(this.commonRange)
        },
        methods: {
            setQuickDate (val) {
                if (val === 'today') {
                    let today = DateUtil.now('Y-m-d')
                    this.setDateRange(today, today)
                } else if (val === 'yesterday') {
                    let yesterday = DateUtil.format('Y-m-d', DateUtil.beforeToday(1))
                    this.setDateRange(yesterday, yesterday)
                } else if (val === 'thisMonth') {
                    let now = new Date()
                    let begin = DateUtil.format('Y-m-d', DateUtil.beginOfMonth(now))
                    this.setDateRange(begin, DateUtil.now('Y-m-d'))
                } else if (val === 'lastMonth') {
                    let month = DateUtil.beforeMonth(1)
                    let begin = DateUtil.format('Y-m-d', DateUtil.beginOfMonth(month))
                    let end = DateUtil.format('Y-m-d', DateUtil.endOfMonth(month))
                    this.setDateRange(begin, end)
                }
                this.setQuickRange(val)
            },
            setDateRange (begin, end) {
                this.setBeginDate(begin, 'quick')
                this.setEndDate(end, 'quick')
            },
            setBeginDate: function (val, eventType) {
                this.$emit('updateBeginValue', val ? val + ' 00:00:00' : '')
                if (eventType !== 'quick') {
                    this.setQuickRange('')
                }
            },
            setEndDate: function (val, eventType) {
                this.$emit('updateEndValue', val ? val + ' 23:59:59' : '')
                if (eventType !== 'quick') {
                    this.setQuickRange('')
                }
            },
            setQuickRange: function (val) {
                this.quickRange = val
                this.$emit('updateCommonRange', val)
            }
        }
    }
</script>
<style scoped>
    .date-picker {
        width: 105px;
    }
</style>
