'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _jquery = require('jquery');

var _jquery2 = _interopRequireDefault(_jquery);

var _bluesdkNotifierAlter = require('bluesdk-notifier-alter');

var _bluesdkNotifierAlter2 = _interopRequireDefault(_bluesdkNotifierAlter);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

require("./notifierArrow.css");


function NotifierArrow() {

    var self = this;

    self.showError = function (errorStr, el) {
        if (el === undefined) {
            self.alert(errorStr);
            return;
        }
        if (typeof el === 'string') {
            el = (0, _jquery2.default)('#' + el);
        }
        if (!el || !el.is(":visible")) {
            //元素不存在或者不可见
            self.alert(errorStr);
            return;
        }

        var top = el.position().top + parseInt(el.css('margin-top'));
        var left = el.position().left + el.width() - 30;
        self.hide(el);
        var errorDivId = self.getErrorDivId(el.attr("id"));
        var html = '<div class="formError _bluesdk_notifier" id="' + errorDivId + '" style="opacity: 0.87; position: absolute; top: ' + top + 'px; left: ' + left + 'px; margin-top: -34px;"><div class="formErrorContent">' + errorStr + '<br></div><div class="formErrorArrow"><div class="line10"><!-- --></div><div class="line9"><!-- --></div><div class="line8"><!-- --></div><div class="line7"><!-- --></div><div class="line6"><!-- --></div><div class="line5"><!-- --></div><div class="line4"><!-- --></div><div class="line3"><!-- --></div><div class="line2"><!-- --></div><div class="line1"><!-- --></div></div></div>';
        el.before(html);
        var errorEl = (0, _jquery2.default)('#' + errorDivId);
        errorEl.css({ 'margin-top': '-' + errorEl.height() + 'px' });
    };

    self.getErrorDivId = function (id) {
        return id + '_validateError';
    };

    /**
     * 重新计算位置
     */
    self.reset = function () {
        (0, _jquery2.default)('.formError').each(function () {
            var id = (0, _jquery2.default)(this).attr('id').replace(/_validateError$/, '');
            var el = (0, _jquery2.default)('#' + id);
            var top = el.position().top + parseInt(el.css('margin-top'));
            var left = el.position().left + el.width() - 30;
            (0, _jquery2.default)(this).css({ top: top, left: left });
        });
    };

    self.init = function () {
        (0, _jquery2.default)(document).on('click', '.formError', function () {
            (0, _jquery2.default)(this).remove();
        });
        (0, _jquery2.default)(window).resize(function () {
            self.reset();
        });
    };

    self.alert = function (msg) {
        _bluesdkNotifierAlter2.default.error(msg);
    };

    self.init();

    /************************开放方法************************/

    self.error = function (error, el) {
        if (typeof error === 'string') {
            self.showError(error, el);
        } else {
            for (var s in error) {
                if (error.hasOwnProperty(s)) {
                    self.showError(error[s], el);
                }
            }
        }
    };

    self.info = function (msg) {
        _bluesdkNotifierAlter2.default.info(msg);
    };

    self.success = function (msg) {
        _bluesdkNotifierAlter2.default.success(msg);
    };

    self.loading = function (msg, timeout) {
        _bluesdkNotifierAlter2.default.loading(msg, timeout);
    };

    self.hide = function (el) {
        var e = (0, _jquery2.default)('#' + self.getErrorDivId(el.attr('id')));
        if (e && e.length > 0) {
            e.remove();
        }
        _bluesdkNotifierAlter2.default.hide();
    };

    self.clear = function () {
        var e = (0, _jquery2.default)('.formError');
        if (e && e.length > 0) {
            e.remove();
        }
        _bluesdkNotifierAlter2.default.clear();
    };
}

exports.default = new NotifierArrow();