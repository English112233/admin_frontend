import $ from 'jquery';
import notifier from 'bluesdk-notifier-alter';
import log from 'bluesdk-logger';
export function post(config) {
    if (config['btn']) {
        if (config['btn'].attr('disabled') === 'disabled')return false;
        config['btn'].attr('disabled', 'disabled');
    }
    if (config['beforePost']) {
        config['beforePost']();
    }
    $.post(config['url'], config['data'], function (res) {
        if (!config['filter']) {
            log.warn('未指定filter');
            return;
        }
        if (config['afterPost']) {
            config['afterPost'](res);
        }
        if (config['filter'](res)) {
            if (config['success']) config['success'](res)
        } else {
            if(config['failFilter'] && !config['failFilter'](res)){
                return
            }
            if (config['fail']) config['fail'](res)
        }

    }, 'json').fail(function () {
        if (config['afterPost']) {
            config['afterPost']();
        }
        notifier.error('请求服务器失败，请检查网络设置。');
    }).always(function () {
        if (config['btn']) config['btn'].removeAttr('disabled');
    });
}