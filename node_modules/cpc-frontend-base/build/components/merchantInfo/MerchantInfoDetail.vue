<template>
    <div id="view">
        <!--面包屑-->
        <slot name="extend"></slot>

        <table class="table table-striped table-bordered table-hover" border="1" cellspacing="0" cellpadding="0"
               style="border-collapse: collapse;border-width:1px;width: 100%;text-align: center">

            <tbody>
            <!--基本信息-->
            <template>
                <tr class="division-msg">
                    <td colspan="2">基本信息</td>
                </tr>
                <slot name="extend-basicInfo"></slot>
                <tr>
                    <td width="200" class="text-right">审核状态</td>
                    <td class="text-left">
                        {{$getObjVal(statusMap,info.infoStatus)}}
                    </td>
                </tr>
                <tr v-if="checkFail">
                    <td class="text-right">审核失败原因</td>
                    <td class="text-left text-warn">{{content.failReason}}</td>
                </tr>
                <tr>
                    <td class="text-right">商户ID</td>
                    <td class="text-left">{{info.merchantId}}</td>
                </tr>
                <tr v-if="content.parentName">
                    <td class="text-right">上级商户</td>
                    <td class="text-left">{{content.parentName}}</td>
                </tr>
                <tr>
                    <td class="text-right">商户类型</td>
                    <td class="text-left">{{info.accountLevel}}级商户</td>
                </tr>
                <tr>
                    <td class="text-right">公司名称</td>
                    <td class="text-left">{{info.companyName}}</td>
                </tr>
                <tr>
                    <td class="text-right">商户简称</td>
                    <td class="text-left">{{info.shortName}}</td>
                </tr>
                <tr>
                    <td class="text-right">经营类目</td>
                    <td class="text-left">{{info.industry}}</td>
                </tr>
                <!--<tr>-->
                <!--<td class="text-right">公司注册国家/地区</td>-->
                <!--<td class="text-left">{{info.countryCode}}</td>-->
                <!--</tr>-->
                <tr>
                    <td class="text-right">所在区县</td>
                    <td class="text-left">{{getDistrictCounty}}</td>
                </tr>
                <tr>
                    <td class="text-right">公司地址</td>
                    <td class="text-left">{{info.companyAddress}}</td>
                </tr>
                <tr>
                    <td class="text-right">邮政编码</td>
                    <td class="text-left">{{info.zipCode}}</td>
                </tr>
                <tr>
                    <td class="text-right">社会统一信用代码</td>
                    <td class="text-left">{{info.licenceNo}}</td>
                </tr>
                <tr>
                    <td class="text-right">网站地址</td>
                    <td class="text-left">{{info.website}}</td>
                </tr>
                <tr>
                    <td class="text-right">联系人</td>
                    <td class="text-left">{{info.linkman}}</td>
                </tr>
                <tr>
                    <td class="text-right">联系邮箱</td>
                    <td class="text-left">{{info.email}}</td>
                </tr>
                <tr>
                    <td class="text-right">联系电话</td>
                    <td class="text-left">{{info.telephone}}</td>
                </tr>


                <tr>
                    <td class="text-right">{{ merchantUtil.businessPicLabel(info.countryCode)}}</td>
                    <td class="text-left">
                        <preview-img :src="info.businessPic"></preview-img>
                    </td>
                </tr>
                <tr v-show="merchantUtil.isChina(info.countryCode)">
                    <td class="text-right">开户许可证</td>
                    <td class="text-left">
                        <preview-img :src="info.accountLicensePic"></preview-img>
                    </td>
                </tr>
                <tr v-if="info.officePic1">
                    <td class="text-right">公司门头照</td>
                    <td class="text-left">
                        <preview-img :src="info.officePic1"></preview-img>
                    </td>
                </tr>
                <tr v-if="info.officePic2">
                    <td class="text-right">公司照片</td>
                    <td class="text-left">
                        <preview-img :src="info.officePic2"></preview-img>
                    </td>
                </tr>
                <tr v-if="info.officePic3">
                    <td class="text-right">公司照片</td>
                    <td class="text-left">
                        <preview-img :src="info.officePic3"></preview-img>
                    </td>
                </tr>
                <tr v-if="info.extraFile">
                    <td class="text-right">其它资料</td>
                    <td class="text-left">
                        <a :href="info.extraFile" target="_blank">其它资料</a>
                    </td>
                </tr>
            </template>

            <!--清算银行卡-->
            <template v-if="bankAccount">
                <tr class="division-msg">
                    <td colspan="2">清算银行卡</td>
                </tr>
                <tr>
                    <td class="text-right">账户类型</td>
                    <td class="text-left">{{$getObjVal(BankAccountTypeEnum.map, bankAccount.accountType)}}</td>
                </tr>
                <tr>
                    <td class="text-right">账户名称</td>
                    <td class="text-left">{{bankAccount.accountName}}</td>
                </tr>
                <tr>
                    <td class="text-right">银行账号</td>
                    <td class="text-left">{{bankAccount.accountNumber}}</td>
                </tr>
                <tr>
                    <td class="text-right">开户银行</td>
                    <td class="text-left">{{bankNoMap[bankAccount.bankNo]}}</td>
                </tr>
                <tr>
                    <td class="text-right">支行名称</td>
                    <td class="text-left">{{bankAccount.bankName}}</td>
                </tr>
            </template>

            <!--法人-->
            <template>
                <tr class="division-msg">
                    <td colspan="2">法人信息</td>
                </tr>
                <tr>
                    <td class="text-right">姓</td>
                    <td class="text-left">{{legalPerson.lastName}}</td>
                </tr>
                <tr>
                    <td class="text-right">名</td>
                    <td class="text-left">{{legalPerson.firstName}}</td>
                </tr>
                <tr>
                    <td class="text-right">身份证号码</td>
                    <td class="text-left">{{legalPerson.idCardNo}}</td>
                </tr>
                <tr>
                    <td class="text-right">证件有效期</td>
                    <td class="text-left" v-if="legalPerson.longTerm">长期</td>
                    <td class="text-left" v-else>{{legalPerson.expireDate}}</td>
                </tr>
                <tr>
                    <td class="text-right">联系邮箱</td>
                    <td class="text-left">{{legalPerson.email}}</td>
                </tr>
                <tr>
                    <td class="text-right">联系电话</td>
                    <td class="text-left">{{legalPerson.telephone}}</td>
                </tr>
                <!--<tr>-->
                <!--<td class="text-right">国别代码</td>-->
                <!--<td class="text-left">{{legalPerson.countryCode}}</td>-->
                <!--</tr>-->
                <tr>
                    <td class="text-right">法人身份证正面照</td>
                    <td class="text-left">
                        <preview-img :src="legalPerson.idPic1"></preview-img>
                    </td>
                </tr>
                <tr>
                    <td class="text-right">法人身份证反面照</td>
                    <td class="text-left">
                        <preview-img :src="legalPerson.idPic2"></preview-img>
                    </td>
                </tr>
            </template>

            <!--受益人-->
            <template v-if="owners && owners.length>0">
                <template v-for="(owner,index) in owners">
                    <tr class="division-msg">
                        <td colspan="2">受益人信息</td>
                    </tr>
                    <tr>
                        <td class="text-right">姓</td>
                        <td class="text-left">{{owner.lastName}}</td>
                    </tr>
                    <tr>
                        <td class="text-right">名</td>
                        <td class="text-left">{{owner.firstName}}</td>
                    </tr>
                    <tr>
                        <td class="text-right">身份证号码</td>
                        <td class="text-left">{{owner.idCardNo}}</td>
                    </tr>
                    <tr>
                        <td class="text-right">证件有效期</td>
                        <td class="text-left" v-if="owner.longTerm">长期</td>
                        <td class="text-left" v-else>{{owner.expireDate}}</td>
                    </tr>
                    <tr>
                        <td class="text-right">联系邮箱</td>
                        <td class="text-left">{{owner.email}}</td>
                    </tr>
                    <tr>
                        <td class="text-right">联系电话</td>
                        <td class="text-left">{{owner.telephone}}</td>
                    </tr>
                    <!--<tr>-->
                    <!--<td class="text-right">国别代码</td>-->
                    <!--<td class="text-left">{{owner.countryCode}}</td>-->
                    <!--</tr>-->
                    <tr>
                        <td class="text-right">受益人身份证正面照</td>
                        <td class="text-left">
                            <preview-img :src="owner.idPic1"></preview-img>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-right">受益人身份证反面照</td>
                        <td class="text-left">
                            <preview-img :src="owner.idPic2"></preview-img>
                        </td>
                    </tr>

                </template>
            </template>

            </tbody>
        </table>


    </div>
</template>
<script>
    import PreviewImg from '../common/PreviewImg'
    import merchantUtil from '../merchantInfo/MerchantUtil'
    import {regionData, CodeToText} from 'element-china-area-data'
    import BankAccountTypeEnum from '../../enum/BankAccountTypeEnum'
    import bankNoMap from 'bluesdk-bank-no'
    import dateUtil from 'bluesdk-date-util'
    import CategoryData from '../../JSON/CategoryData'

    export default {
        name: 'MerchantInfoDetail',
        components: {PreviewImg},
        data: function () {
            return {
                bankNoMap,
                BankAccountTypeEnum,
                checking: false,
                checkFail: false,
                statusMap: {},
                content: {
                    merchantInfo: {}
                },
                info: {},
                merchantUtil: merchantUtil,
                bankAccount: null,
                legalPerson: {},
                owners: [] // 受益人
            }
        },
        computed: {
            getDistrictCounty: function () {
                let codeArr = this.recursionDistrictCounty(regionData, this.info.areaCode)
                codeArr = codeArr.map(item => CodeToText[item])
                return codeArr.join('/ ')
            }
        },
        methods: {
            initData (content) {
                this.content = content
                this.checking = content.infoStatusChecking === content.merchantInfo.infoStatus
                this.checkFail = content.infoStatusFail === content.merchantInfo.infoStatus
                this.info = content.merchantInfo
                this.statusMap = content.infoStatusOptions

                this.bankAccount = content.bankAccount // 清算银行
                this.legalPerson = content.legalPerson || {} // 法人
                this.owners = content.owners || [] // 受益人

                this.legalPerson && (this.dateInitFn(this.legalPerson)) // 初始化法人证件有效期
                this.owners && this.owners.map((sun) => this.dateInitFn(sun)) // 初始收益人证件有效期

                let industryVal = this.info.industry
                industryVal && (this.info.industry = this.CategoryCodeToText([industryVal.substring(0, 3), industryVal.substring(0, 6), industryVal])) // 初始化经营类目
            },
            /**
             *  级联组件回显，根据最后一级code找到父级code
             *  @listData 需要进行递归遍历的数据
             *  @code 最后一级的code
             * */
            recursionDistrictCounty (listData, code) {
                if (!code) {
                    return []
                }
                let selectArr = []
                let fn = function (list) {
                    for (let i = 0; i < list.length; i++) {
                        let item = list[i]
                        if (item.value === code) {
                            return true
                        } else {
                            if (item.children && item.children.length) {
                                if (fn(item.children)) {
                                    selectArr.push(item.value)
                                    return true
                                }
                            }
                        }
                    }
                }
                fn(listData) // 开始递归
                selectArr.unshift(code) // 将子级的code也追加进去
                return selectArr.reverse()
            },
            /**
             *  初始化法法人受益人证件有效期
             * */
            dateInitFn: function (item) {
                if (item && item.expireDate) {
                    item.expireDate = dateUtil.format('Y-m-d', item.expireDate / 1000)
                }
            },
            /**
             * 经营类目值获取
             * @arr  经营类目code码 如：[a,b,c]
             * */
            CategoryCodeToText: function (arr) {
                let index = 0
                let brr = []
                let fn = function (data, code) {
                    for (let i = 0; i < data.length; i++) {
                        let item = data[i]
                        if (item.value === code) {
                            brr.push(item.label)
                            if (index !== 2) {
                                index++
                                item.children && (fn(item.children, arr[index]))
                            }
                            break
                        }
                    }
                }
                fn(CategoryData, arr[0])
                return brr.join('/ ')
            }
        }
    }
</script>
<style scoped>
    .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th {
        vertical-align: middle;
    }

    .table-bordered, .table-bordered > tbody > tr > td, .table-bordered > tbody > tr > th, .table-bordered > tfoot > tr > td, .table-bordered > tfoot > tr > th, .table-bordered > thead > tr > td, .table-bordered > thead > tr > th {
        border: 1px solid #ddd;
    }

    .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th {
        padding: 8px;
        line-height: 1.42857143;
        vertical-align: top;
        border-top: 1px solid #ddd;
    }

    *, :after, :before {
        box-sizing: border-box;
    }

    tr:nth-child(2n) {
        background-color: rgb(249, 249, 249);
    }

    tr:hover {
        background-color: rgb(245, 245, 245);
    }

    .text-warn {
        color: #e6a23c;
    }

    .division-msg, .division-msg:hover {
        background: #e0d6d6 !important;
        font-weight: bold;
    }

</style>

