<template>
    <div>
        <!--基本信息-->
        <div class="module-one">
            <h1 class="ms-title"><p class="common-dot-title"><i class="icon"></i> 基本信息</p></h1>
            <div class="common-box">
                <div class="detail-table">
                    <slot name="extend-basicInfo"></slot>
                    <ul>
                        <li>审核状态</li>
                        <li>
                            <!--{{$getObjVal(statusMap,info.infoStatus)}}-->
                            <span class="m-success" v-if="checkSuccess">已完成企业认证<img v-if="sImg" :src="sImg"/></span>
                            <span class="m-warn" v-if="checkNone">你尚未进行企业认证</span>
                            <span class="m-error" v-if="checkFail">认证失败</span>
                        </li>
                    </ul>
                    <ul v-if="checkFail">
                        <li>审核失败原因</li>
                        <li>{{content.failReason}}</li>
                    </ul>
                    <ul>
                        <li>商户ID</li>
                        <li>{{info.merchantId}}</li>
                    </ul>
                    <ul v-if="content.parentName">
                        <li>上级商户</li>
                        <li>{{content.parentName}}</li>
                    </ul>
                    <ul>
                        <li>商户类型</li>
                        <li>{{info.accountLevel}}级商户</li>
                    </ul>
                    <ul>
                        <li>公司名称</li>
                        <li>{{info.companyName}}</li>
                    </ul>
                    <ul>
                        <li>商户简称</li>
                        <li>{{info.shortName}}</li>
                    </ul>
                    <ul>
                        <li>经营类目</li>
                        <li>{{info.industry}}</li>
                    </ul>
                    <ul>
                        <li>所在区县</li>
                        <li>{{getDistrictCounty}}</li>
                    </ul>
                    <ul>
                        <li>公司地址</li>
                        <li>{{info.companyAddress}}</li>
                    </ul>
                    <ul>
                        <li>邮政编码</li>
                        <li>{{info.zipCode}}</li>
                    </ul>
                    <ul>
                        <li>社会统一信用代码</li>
                        <li>{{info.licenceNo}}</li>
                    </ul>
                    <ul>
                        <li>网站地址</li>
                        <li>{{info.website}}</li>
                    </ul>
                    <ul>
                        <li>联系人</li>
                        <li>{{info.linkman}}</li>
                    </ul>
                    <ul>
                        <li>联系邮箱</li>
                        <li>{{info.email}}</li>
                    </ul>
                    <ul>
                        <li>联系电话</li>
                        <li>{{info.telephone}}</li>
                    </ul>
                    <ul>
                        <li>{{ merchantUtil.businessPicLabel(info.countryCode)}}</li>
                        <li>
                            <preview-img :src="info.businessPic"></preview-img>
                        </li>
                    </ul>
                    <ul v-show="merchantUtil.isChina(info.countryCode)">
                        <li>开户许可证</li>
                        <li>
                            <preview-img :src="info.accountLicensePic"></preview-img>
                        </li>
                    </ul>
                    <ul v-if="info.officePic1">
                        <li>公司门头照</li>
                        <li>
                            <preview-img :src="info.officePic1"></preview-img>
                        </li>
                    </ul>
                    <ul v-if="info.officePic2">
                        <li>公司照片</li>
                        <li>
                            <preview-img :src="info.officePic2"></preview-img>
                        </li>
                    </ul>
                    <ul v-if="info.officePic3">
                        <li>公司照片</li>
                        <li>
                            <preview-img :src="info.officePic3"></preview-img>
                        </li>
                    </ul>
                    <ul v-if="info.extraFile">
                        <li>其它资料</li>
                        <li><a :href="info.extraFile" target="_blank">其它资料</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <!--清算银行卡-->
        <template v-if="bankAccount">
            <div class="module-one">
                <h1 class="ms-title"><p class="common-dot-title"><i class="icon"></i> 清算银行卡</p></h1>
                <div class="common-box">
                    <div class="detail-table">
                        <ul>
                            <li>账户类型</li>
                            <li>{{$getObjVal(BankAccountTypeEnum.map, bankAccount.accountType)}}</li>
                        </ul>
                        <ul>
                            <li>账户名称</li>
                            <li>{{bankAccount.accountName}}</li>
                        </ul>
                        <ul>
                            <li>银行账号</li>
                            <li>{{bankAccount.accountNumber}}</li>
                        </ul>
                        <ul>
                            <li>开户银行</li>
                            <li>{{bankNoMap[bankAccount.bankNo]}}</li>
                        </ul>
                        <ul>
                            <li>支行名称</li>
                            <li>{{bankAccount.bankName}}</li>
                        </ul>
                    </div>
                </div>
            </div>
        </template>

        <!--法人-->
        <template>
            <div class="module-one">
                <h1 class="ms-title"><p class="common-dot-title"><i class="icon"></i> 法人信息</p></h1>
                <div class="common-box">
                    <div class="detail-table">
                        <ul>
                            <li>姓</li>
                            <li>{{legalPerson.lastName}}</li>
                        </ul>
                        <ul>
                            <li>名</li>
                            <li>{{legalPerson.firstName}}</li>
                        </ul>
                        <ul>
                            <li>身份证号码</li>
                            <li>{{legalPerson.idCardNo}}</li>
                        </ul>
                        <ul>
                            <li>证件有效期</li>
                            <li v-if="legalPerson.longTerm">长期</li>
                            <li v-else>{{legalPerson.expireDate}}</li>
                        </ul>
                        <ul>
                            <li>联系邮箱</li>
                            <li>{{legalPerson.email}}</li>
                        </ul>
                        <ul>
                            <li>联系电话</li>
                            <li>{{legalPerson.telephone}}</li>
                        </ul>
                        <ul>
                            <li>法人身份证正面照</li>
                            <li>
                                <preview-img :src="legalPerson.idPic1"></preview-img>
                            </li>
                        </ul>
                        <ul>
                            <li>法人身份证反面照</li>
                            <li>
                                <preview-img :src="legalPerson.idPic2"></preview-img>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </template>

        <!--受益人-->
        <template v-if="owners && owners.length>0">
            <template v-for="(owner,index) in owners">
                <div class="module-one">
                    <h1 class="ms-title"><p class="common-dot-title"><i class="icon"></i> 受益人信息</p></h1>
                    <div class="common-box">
                        <div class="detail-table">
                            <ul>
                                <li>姓</li>
                                <li>{{owner.lastName}}</li>
                            </ul>
                            <ul>
                                <li>名</li>
                                <li>{{owner.firstName}}</li>
                            </ul>
                            <ul>
                                <li>身份证号码</li>
                                <li>{{owner.idCardNo}}</li>
                            </ul>
                            <ul>
                                <li>证件有效期</li>
                                <li v-if="owner.longTerm">长期</li>
                                <li v-else>{{owner.expireDate}}</li>
                            </ul>
                            <ul>
                                <li>联系邮箱</li>
                                <li>{{owner.email}}</li>
                            </ul>
                            <ul>
                                <li>联系电话</li>
                                <li>{{owner.telephone}}</li>
                            </ul>
                            <ul>
                                <li>受益人身份证正面照</li>
                                <li>
                                    <preview-img :src="owner.idPic1"></preview-img>
                                </li>
                            </ul>
                            <ul>
                                <li>受益人身份证反面照</li>
                                <li>
                                    <preview-img :src="owner.idPic2"></preview-img>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </template>
        </template>

    </div>
</template>
<script>
    import PreviewImg from '../common/PreviewImg'
    import merchantUtil from '../merchantInfo/MerchantUtil'
    import { regionData, CodeToText } from 'element-china-area-data'
    import BankAccountTypeEnum from '../../enum/BankAccountTypeEnum'
    import bankNoMap from 'bluesdk-bank-no'
    import dateUtil from 'bluesdk-date-util'
    import CategoryData from '../../JSON/CategoryData'

    export default {
        name: 'MerchantInfoDetailNew',
        props: {
            sImg: { // 审核通过图标
                type: String,
                default: ''
            }
        },
        components: { PreviewImg },
        data: function () {
            return {
                bankNoMap,
                BankAccountTypeEnum,
                checking: false,
                checkFail: false, // 审核失败
                checkSuccess: false, // 审核通过
                checkNone: false,// 未提交
                statusMap: {},
                content: {
                    merchantInfo: {}
                },
                info: {},
                merchantUtil: merchantUtil,
                bankAccount: null,
                legalPerson: {},
                owners: [] // 受益人
            }
        },
        computed: {
            getDistrictCounty: function () {
                let codeArr = this.recursionDistrictCounty(regionData, this.info.areaCode)
                codeArr = codeArr.map(item => CodeToText[item])
                return codeArr.join('/ ')
            }
        },
        methods: {
            initData (content) {
                this.content = content
                this.checking = content.infoStatusChecking === content.merchantInfo.infoStatus
                this.checkFail = content.infoStatusFail === content.merchantInfo.infoStatus
                this.checkSuccess = content.infoStatusSuccess === content.merchantInfo.infoStatus
                this.checkNone = content.infoStatusNone === content.merchantInfo.infoStatus
                this.info = content.merchantInfo
                this.statusMap = content.infoStatusOptions

                this.bankAccount = content.bankAccount // 清算银行
                this.legalPerson = content.legalPerson || {} // 法人
                this.owners = content.owners || [] // 受益人

                this.legalPerson && (this.dateInitFn(this.legalPerson)) // 初始化法人证件有效期
                this.owners && this.owners.map((sun) => this.dateInitFn(sun)) // 初始收益人证件有效期

                let industryVal = this.info.industry
                industryVal && (this.info.industry = this.CategoryCodeToText([industryVal.substring(0, 3), industryVal.substring(0, 6), industryVal])) // 初始化经营类目
            },
            /**
             *  级联组件回显，根据最后一级code找到父级code
             *  @listData 需要进行递归遍历的数据
             *  @code 最后一级的code
             * */
            recursionDistrictCounty (listData, code) {
                if (!code) {
                    return []
                }
                let selectArr = []
                let fn = function (list) {
                    for (let i = 0; i < list.length; i++) {
                        let item = list[i]
                        if (item.value === code) {
                            return true
                        } else {
                            if (item.children && item.children.length) {
                                if (fn(item.children)) {
                                    selectArr.push(item.value)
                                    return true
                                }
                            }
                        }
                    }
                }
                fn(listData) // 开始递归
                selectArr.unshift(code) // 将子级的code也追加进去
                return selectArr.reverse()
            },
            /**
             *  初始化法法人受益人证件有效期
             * */
            dateInitFn: function (item) {
                if (item && item.expireDate) {
                    item.expireDate = dateUtil.format('Y-m-d', item.expireDate / 1000)
                }
            },
            /**
             * 经营类目值获取
             * @arr  经营类目code码 如：[a,b,c]
             * */
            CategoryCodeToText: function (arr) {
                let index = 0
                let brr = []
                let fn = function (data, code) {
                    for (let i = 0; i < data.length; i++) {
                        let item = data[i]
                        if (item.value === code) {
                            brr.push(item.label)
                            if (index !== 2) {
                                index++
                                item.children && (fn(item.children, arr[index]))
                            }
                            break
                        }
                    }
                }
                fn(CategoryData, arr[0])
                return brr.join('/ ')
            }
        }
    }
</script>
<style scoped lang="less">
    .common-box {
        margin: .10rem 0 .25rem 0;
        position: relative;
    }

    .add-person {
        padding-top: 0;
        padding-bottom: 0;

        .add {
            img {
                cursor: pointer;
                vertical-align: middle;
                width: .20rem;
                height: .20rem;
            }
        }
    }
    .detail-table {
        width: 100%;
        box-sizing: border-box;
        padding: .30rem .25rem;

        ul, li {
            list-style: none;
        }

        ul {
            width: 100%;
            display: flex;
            flex-wrap: nowrap;
            flex-direction: row;
            align-items: center;
            border-radius: .45rem;
            color: #333333;
            font-size: .14rem;

            &:hover {
                background: #fcfcfc;
            }
        }

        li {
            line-height:.45rem;
            padding-left: .40rem;
            flex-grow: 1; // 铺满
            a {
                cursor: pointer;
            }
        }

        li:first-child {
            width: 2rem;
            flex-grow: 0;
            box-sizing: border-box;
            padding-left: .20rem;
            color: #999999;
            text-align: right;
        }

        li:nth-child(3) {
            width: .80rem;
            text-align: center;
            flex-grow: 0;
        }

        span {
            /*margin-left: .25rem;*/

            img {
                width: .20rem;
                height: .20rem;
                margin-left: .15rem;
                vertical-align: middle;
            }

            &.m-success {
                color: #00d66f;
            }

            &.m-warn {
                color: #f37539;
            }

            &.m-error {
                color: #ff0000;
            }
        }
    }

    .common-box {
        margin: 0 0 .25rem 0;
        position: relative;
    }

    .ms-title {
        height: .70rem;
        line-height: .70rem;
        font-weight: normal;
        color: #333333;
        font-size: .18rem;
        background: #ffffff;
        box-sizing: border-box;
        padding: 0 .40rem;
        border-bottom: .01rem solid #eeeeee;
    }

    .common-box {
        border-radius: 0 0 .05rem .05rem;
    }
</style>
